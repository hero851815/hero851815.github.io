# TDS笔记


# 基础概念

## 分层概念

### ODS

+ ODS层最好理解，基本上就是数据从源表拉过来，进行etl，比如mysql 映射到hive，那么到了hive里面就是ods层。

+ ODS 全称是 Operational Data Store，操作数据存储.“面向主题的”，数据运营层，也叫ODS层，是最接近数据源中数据的一层，数据源中的数据，经过抽取、洗净、传输，也就说传说中的 ETL 之后，装入本层。本层的数据，总体上大多是按照源头业务系统的分类方式而分类的。但是，这一层面的数据却不等同于原始数据。**在源数据装入这一层时，要进行诸如去噪(例如有一条数据中人的年龄是 300 岁，这种属于异常数据，就需要提前做一些处理)**、去重(例如在个人资料表中，同一 ID 却有两条重复数据，在接入的时候需要做一步去重)、字段命名规范等一系列操作。

### DW

数据仓库层(DW)，是数据仓库的主体.在这里，从 ODS 层中获得的数据按照主题建立各种数据模型。这一层和维度建模会有比较深的联系。

细分：

1. 数据明细层：DWD（Data Warehouse Detail）
2. 数据中间层：DWM（Data WareHouse Middle）
3. 数据服务层：DWS（Data WareHouse Servce）

> DWD明细层
> 
> > + 概念：是数据仓库的细节数据层，是对STAGE层数据进行沉淀，减少了抽取的复杂性，同时ODS/DWD的信息模型组织主要遵循企业业务事务处理的形式，将各个专业数据进行集中，明细层跟stage层的粒度一致，属于分析的公共资源
> > + 数据生成方式：部分数据直接来自kafka，部分数据为接口层数据与历史数据合成。
> > + 这个stage层不是很清晰



> DWM轻度汇总层
> 
> > + 概念：轻度汇总层数据仓库中DWD层和DM层之间的一个过渡层次，是对DWD层的生产数据进行轻度综合和汇总统计(可以把复杂的清洗，处理包含，如根据PV日志生成的会话数据)。轻度综合层与DWD的主要区别在于二者的应用领域不同，DWD的数据来源于生产型系统，并未满意一些不可预见的需求而进行沉淀;轻度综合层则面向分析型应用进行细粒度的统计和沉淀
> > + 数据生成方式：由明细层按照一定的业务需求生成轻度汇总表。明细层需要复杂清洗的数据和需要MR处理的数据也经过处理后接入到轻度汇总层。
> > + 日志存储方式：内表，parquet文件格式。
> > + 日志删除方式：长久存储。
> > + 表schema：一般按天创建分区，没有时间概念的按具体业务选择分区字段。
> > + 库与表命名。库名：dwb,表名：初步考虑格式为：dwb日期业务表名,待定。
> > + 旧数据更新方式：直接覆盖



> DWS主题层
> 
> > + 概念：又称数据集市或宽表。按照业务划分，如流量、订单、用户等，生成字段比较多的宽表，**用于提供后续的业务查询，OLAP分析，数据分发等。**
> > + 数据生成方式：由轻度汇总层和明细层数据计算生成。
> > + 日志存储方式：使用impala内表，parquet文件格式。
> > + 日志删除方式：长久存储。
> > + 表schema：一般按天创建分区，没有时间概念的按具体业务选择分区字段。
> > + 库与表命名。库名：dm,表名：初步考虑格式为：dm日期业务表名,待定。
> > + 旧数据更新方式：直接覆盖

### APP

数据产品层(APP)，这一层是提供为数据产品使用的结果数据。

主要是提供给数据产品和数据分析使用的数据，一般会存放在 ES、Mysql 等系统中供线上系统使用，也可能会存在 Hive 或者 Druid 中供数据分析和数据挖掘使用。



# TDS模块

## 1.SQL

### 开发

### 自主建表

建表类型包括orc,torc,text。建立的表无法直接使用，包括加载、工作流都只能用引入数据源的方式

#### 表所有权

内表和外表

> 区分：
> 
> > + 删除内表时，内表数据会一并删除
> > 
> > + 删除外表时，外表数据依旧存在
> 
> 应用场景：
> 
> > + 外部表在删除时不会清理HDFS上的数据，所以相对较安全，同时由于其指定目录的特性，在跨部门合作中经常用到。所以不小心删除外部表后，可以创建一个新表指定到（location‘/hive/external_table/’）这个位置，那么数据就会恢复。
> > 
> > + 对于一些原始日志文件，同时被多个部门同时操作的时候就需要使用外部表，如果不小心将meta data删除了，HDFS上 的data还在可以恢复，增加了数据的安全性

#### 表类型

orc/torc/text

orc：一种列式存储格式

torc：orc建表基础上增加`TBLPROPERTIES('transactional'='true')`，支持事务

text：默认格式，导入数据时会直接把数据文件拷贝到hdfs上不进行处理

#### 分桶配置

配置分桶键以及分桶个数，建表基础上增加`CLUSTERED BY ('id') INTO 3 BUCKETS`

## 2.整合

## 3.调度

## 4.服务

## 5.管控

## 6.资产

## 7.安全

## 8.商城

## 9.运维

## 10.配置

### 数据源

新建时选择数据源/连接方式/认证模式

